CREATE DATABASE crypto;

CREATE TABLE tb_blockchain_master (
  upd_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  symbol VARCHAR(10) NOT NULL,
  best_height BIGINT NOT NULL DEFAULT 0,
  synched_height BIGINT NOT NULL DEFAULT 0,
  decimals INTEGER NOT NULL DEFAULT 8,
  send_mast_addr VARCHAR(128),
  last_tx_fee DECIMAL(10,8) DEFAULT 0,
  last_gas_price DECIMAL(8,4) DEFAULT 0,
  last_gas_used DECIMAL(8,4) DEFAULT 0,
  PRIMARY KEY (symbol)
);

CREATE TABLE tb_address_balance (
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  uid INTEGER NOT NULL,
  symbol VARCHAR(10) NOT NULL,
  addr VARCHAR(128) NOT NULL,
  balance DECIMAL(24,8) NOT NULL DEFAULT 0,
  account VARCHAR(100),
  tag VARCHAR(100),
  broker_id CHAR(4),
  PRIMARY KEY (symbol,addr)
);

CREATE TABLE tb_trans (
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  upd_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  re_notify CHAR(1) NOT NULL DEFAULT 'N',
  symbol VARCHAR(10) NOT NULL,
  txid VARCHAR(255) NOT NULL,
  block_id VARCHAR(128),
  order_id VARCHAR(20),
  notifiable CHAR(1) NOT NULL DEFAULT 'N',
  confirm INT NOT NULL DEFAULT 0,
  noti_cnt INT NOT NULL DEFAULT 0,
  to_addr VARCHAR(128) NOT NULL,
  to_tag VARCHAR(20),
  amount DECIMAL(24,8) NOT NULL DEFAULT 0,
  tx_idx VARCHAR(10),
  uid INTEGER NOT NULL,
  from_addr VARCHAR(128),
  from_account VARCHAR(20),
  from_tag VARCHAR(20),
  tx_time BIGINT DEFAULT 0,
  expt_fee DECIMAL(10,8),
  real_fee DECIMAL(10,8),
  err_msg VARCHAR(200),
  broker_id CHAR(4),
  PRIMARY KEY (symbol,txid)
);

CREATE TABLE tb_error (
  reg_dt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  idx INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY(START WITH 1, INCREMENT BY 1),
  uid INTEGER,
  symbol VARCHAR(10),
  addr VARCHAR(128),
  txid VARCHAR(255),
  PRIMARY KEY (idx)
);